# ✅ Vercel 部署优化完成

## 📦 已创建的文件

| 文件 | 说明 | 必需性 |
|------|------|--------|
| `vercel.json` | Vercel 部署配置（路径重写、缓存策略） | ✅ 必需 |
| `package.json` | 项目描述文件 | ⚠️ 建议有 |
| `.vercelignore` | 忽略不需要部署的文件 | ⚠️ 建议有 |
| `DEPLOY.md` | 详细部署指南 | 📖 文档 |
| `optimize_images.py` | 图片优化脚本 | 🔧 工具 |
| `deploy.sh` | 快速部署脚本 | 🚀 工具 |
| `部署优化总结.md` | 本文档 | 📋 总结 |

---

## 🎯 优化亮点

### 1. 路径配置 ✅
- ✅ 使用 `vercel.json` 将根路径重定向到 `/omikuji/`
- ✅ 用户访问 `https://域名/` 自动访问 `/omikuji/index.html`
- ✅ 无需修改项目结构

### 2. 缓存策略 ⚡
- ✅ 静态资源（CSS/JS/图片）缓存 1 年
- ✅ 自动启用 Vercel CDN 全球加速
- ✅ `immutable` 标记，最大化缓存效率

### 3. 文件优化 📦
- ✅ `.vercelignore` 排除不需要的文件（开发脚本、临时文件）
- ✅ 可选图片压缩（减少 30-40% 大小）
- ✅ 保持原有项目结构不变

### 4. 部署工具 🛠️
- ✅ 一键部署脚本 `deploy.sh`
- ✅ 图片优化工具 `optimize_images.py`
- ✅ 详细部署文档 `DEPLOY.md`

---

## 🚀 快速部署步骤

### 方法一：使用部署脚本（推荐）

```bash
# 1. 安装 Vercel CLI（首次）
npm install -g vercel

# 2. 运行部署脚本
./deploy.sh
```

脚本会自动：
1. 检查环境
2. 询问是否优化图片
3. 选择部署模式（预览/生产）
4. 执行部署

### 方法二：手动部署

```bash
# 1. 登录 Vercel
vercel login

# 2. 预览部署
vercel

# 3. 生产部署
vercel --prod
```

### 方法三：通过 GitHub（自动部署）

```bash
# 1. 初始化 Git
git init
git add .
git commit -m "Initial commit"

# 2. 推送到 GitHub
git remote add origin https://github.com/你的用户名/仓库名.git
git push -u origin main

# 3. 在 Vercel 网站导入 GitHub 仓库
# 访问 vercel.com → Import Project
```

---

## 📊 项目状态

### 部署前

```
项目大小：~38MB（主要是图片）
- HTML/CSS/JS：~40KB
- JSON 数据：~50KB
- 签文图片：~38MB（202张）
```

### 优化后（可选）

```
项目大小：~22-26MB（压缩 30-40%）
- 图片质量：85%（肉眼几乎无差别）
- 加载速度：提升 30-40%
```

---

## ✅ 部署检查清单

### 部署前

- [x] 创建 `vercel.json` 配置
- [x] 创建 `package.json`
- [x] 创建 `.vercelignore`
- [ ] （可选）运行 `optimize_images.py` 压缩图片
- [ ] 测试本地运行正常

### 部署中

- [ ] 安装 Vercel CLI：`npm install -g vercel`
- [ ] 登录 Vercel：`vercel login`
- [ ] 首次部署：`vercel`
- [ ] 生产部署：`vercel --prod`

### 部署后

- [ ] 访问部署链接，测试首页
- [ ] 测试抽签功能（点击 + 摇一摇）
- [ ] 检查图片加载（正反面切换）
- [ ] 测试历史记录保存
- [ ] 测试设置功能
- [ ] 手机上测试摇一摇
- [ ] 检查性能（Lighthouse 分数）

---

## 🔧 配置说明

### vercel.json 核心配置

```json
{
  "rewrites": [
    // 将所有请求重定向到 omikuji 目录
    { "source": "/(.*)", "destination": "/omikuji/$1" }
  ],
  "headers": [
    // 静态资源缓存配置
    {
      "source": "/omikuji/data/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

**说明**：
- `rewrites`：URL 重写规则，用户访问根路径时自动访问 omikuji 目录
- `headers`：HTTP 响应头，设置缓存策略
- `max-age=31536000`：缓存 1 年（秒）
- `immutable`：内容不会改变，浏览器可以安全缓存

---

## 📈 性能预期

### 首次访问

- 首屏加载：2-3秒
- 图片加载：3-5秒（全部 202 张）
- Lighthouse 分数：85-95

### 二次访问（缓存后）

- 首屏加载：< 1秒
- 图片加载：< 1秒（从缓存读取）
- Lighthouse 分数：95+

---

## 🌍 访问地址

部署成功后，你将获得：

1. **预览地址**：`https://yinian-omikuji-xxx.vercel.app`
   - 每次 `vercel` 部署会生成唯一预览链接
   - 用于测试和预览

2. **生产地址**：`https://yinian-omikuji.vercel.app`
   - `vercel --prod` 部署后的正式链接
   - 固定域名，可以分享

3. **自定义域名**（可选）：`https://yinian.你的域名.com`
   - 在 Vercel 项目设置中添加
   - 免费 SSL 证书

---

## 💡 使用建议

### 1. 图片优化建议

如果你的目标用户主要在国内，建议：
- ✅ 运行 `optimize_images.py`（质量 85%）
- ✅ 减少 30-40% 大小，加快加载速度
- ✅ 图片质量肉眼几乎看不出差别

如果你的目标用户网络较好，可以：
- ⭕ 保持原图质量
- ⭕ 依赖 Vercel CDN 加速

### 2. 域名建议

- 建议绑定自定义域名（更专业）
- 可以使用中文拼音域名：
  - `yinian.com`（一念）
  - `qiuqian.com`（求签）
  - `omikuji.cn`（御神签）

### 3. SEO 优化（可选）

在 `omikuji/index.html` 的 `<head>` 中添加：

```html
<!-- SEO Meta -->
<meta name="description" content="一念 - 浅草寺御神签抽签应用，禅意极简设计，100%吉祥签模式，带来美好祝福">
<meta name="keywords" content="抽签,御神签,浅草寺,fortune,omikuji,求签,运势">

<!-- Open Graph (社交分享) -->
<meta property="og:title" content="一念 - 浅草寺御神签">
<meta property="og:description" content="禅意极简的抽签应用，轻摇得一签">
<meta property="og:type" content="website">
<meta property="og:url" content="https://你的域名.vercel.app">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="一念 - 浅草寺御神签">
<meta name="twitter:description" content="禅意极简的抽签应用，轻摇得一签">
```

---

## 🐛 常见问题

### Q1: 部署后页面空白？

**可能原因**：
- 路径配置错误
- JavaScript 加载失败

**解决方案**：
1. 检查浏览器控制台（F12）是否有错误
2. 确认 `vercel.json` 配置正确
3. 确认所有资源路径使用相对路径

### Q2: 图片 404 错误？

**可能原因**：
- 图片目录未正确上传
- `.vercelignore` 误排除了图片目录

**解决方案**：
1. 检查 `.vercelignore` 不要包含 `data/senso-ji-omikuji-main/`
2. 重新部署：`vercel --prod --force`

### Q3: 手机摇一摇不工作？

**可能原因**：
- 未使用 HTTPS
- 未授权传感器权限

**解决方案**：
- Vercel 自动提供 HTTPS（✅ 已解决）
- iOS Safari：首次摇动时点击"允许"
- 不要在微信内置浏览器打开

### Q4: 部署速度慢？

**可能原因**：
- 图片文件较大（38MB）

**解决方案**：
1. 运行 `optimize_images.py` 压缩图片
2. 或者耐心等待（首次部署需要上传所有文件）
3. 后续部署只会上传变更文件，会很快

---

## 📞 获取帮助

- **Vercel 文档**：https://vercel.com/docs
- **项目说明**：查看 `README.md`
- **部署指南**：查看 `DEPLOY.md`
- **图片功能**：查看 `omikuji/图片查看功能说明.md`

---

## 🎉 完成！

你现在拥有：
- ✅ 完整的 Vercel 部署配置
- ✅ 自动化部署脚本
- ✅ 图片优化工具
- ✅ 详细的部署文档

**准备好了吗？运行 `./deploy.sh` 开始部署吧！** 🚀

---

**最后更新**：2026-02-27
**状态**：✅ 已优化，可部署
