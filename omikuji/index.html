<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>一念 - 摇签问卦</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <!-- 启动页 -->
        <transition name="fade">
            <div v-if="currentPage === 'splash'" class="page splash-page">
                <div class="splash-content">
                    <h1 class="app-title">一念</h1>
                    <div class="divider"></div>
                    <p class="app-subtitle">轻摇，得一签</p>
                </div>
                <div class="version">v1.0.0</div>
            </div>
        </transition>

        <!-- 许愿页 -->
        <transition name="slide">
            <div v-if="currentPage === 'wish'" class="page wish-page">
                <button class="close-btn" @click="skipWish">×</button>
                <div class="wish-content">
                    <h2 class="page-title">静心，许愿</h2>
                    <textarea
                        v-model="userWish"
                        class="wish-input"
                        placeholder="在此输入心愿或想问的问题..."
                        maxlength="100"
                    ></textarea>
                    <div class="char-count">{{ userWish.length }}/100</div>
                </div>
                <div class="button-group">
                    <button class="text-button" @click="skipWish">跳过</button>
                    <button class="primary-button" @click="goToShake">抽签</button>
                </div>
            </div>
        </transition>

        <!-- 摇签页 -->
        <transition name="slide">
            <div v-if="currentPage === 'shake'" class="page shake-page">
                <div class="shake-content">
                    <div class="sign-container" :class="{ shaking: isShaking }">
                        <svg class="sign-icon" viewBox="0 0 120 120" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="30" y="20" width="60" height="80" rx="8" />
                            <line x1="40" y1="30" x2="40" y2="90" />
                            <line x1="50" y1="30" x2="50" y2="90" />
                            <line x1="60" y1="30" x2="60" y2="90" />
                            <line x1="70" y1="30" x2="70" y2="90" />
                            <line x1="80" y1="30" x2="80" y2="90" />
                        </svg>
                    </div>
                    <p class="shake-hint">{{ isShaking ? '抽签中...' : '轻摇手机抽签' }}</p>

                    <!-- 模拟器调试按钮 -->
                    <button v-if="!isMobile" class="debug-button" @click="simulateShake">
                        点击模拟摇动
                    </button>
                </div>
                <button class="history-link" @click="goToHistory">查看历史记录</button>
            </div>
        </transition>

        <!-- 签文详解页 -->
        <transition name="slide">
            <div v-if="currentPage === 'fortune'" class="page fortune-page">
                <div class="fortune-header">
                    <button class="back-btn" @click="goBack">←</button>
                    <button class="menu-btn" @click="showMenu = !showMenu">⋯</button>
                </div>

                <div class="fortune-content" v-if="currentFortune">
                    <h1 class="fortune-number">{{ currentFortune.formattedId }}</h1>
                    <p class="fortune-level" :style="{ color: getLevelColor(currentFortune.level) }">
                        {{ currentFortune.level }}
                    </p>

                    <div class="divider"></div>

                    <!-- 浅草寺签文图片 -->
                    <div class="omikuji-images">
                        <h3 class="section-title">【浅草寺原版签文】</h3>
                        <div class="image-tabs">
                            <button
                                class="tab-button"
                                :class="{ active: showImageSide === 'front' }"
                                @click="showImageSide = 'front'"
                            >
                                正面
                            </button>
                            <button
                                class="tab-button"
                                :class="{ active: showImageSide === 'back' }"
                                @click="showImageSide = 'back'"
                            >
                                背面
                            </button>
                        </div>
                        <div class="image-container">
                            <img
                                v-if="showImageSide === 'front' && currentFortune.imageFront"
                                :src="'data/' + currentFortune.imageFront"
                                :alt="currentFortune.formattedId + ' 正面'"
                                class="omikuji-image"
                                @click="showImageFullscreen(currentFortune.imageFront)"
                            >
                            <img
                                v-if="showImageSide === 'back' && currentFortune.imageBack"
                                :src="'data/' + currentFortune.imageBack"
                                :alt="currentFortune.formattedId + ' 背面'"
                                class="omikuji-image"
                                @click="showImageFullscreen(currentFortune.imageBack)"
                            >
                        </div>
                        <p class="image-hint">点击图片可放大查看</p>
                    </div>

                    <div class="divider"></div>

                    <div class="poem-section">
                        <h3 class="section-title">【签诗】</h3>
                        <div class="poem-content">
                            <p v-for="(line, index) in currentFortune.poem.lines" :key="index" class="poem-line">
                                {{ line }}
                            </p>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="interpretation-section">
                        <h3 class="section-title">【现代解读】</h3>

                        <div v-for="section in interpretationSections" :key="section.title" class="interpretation-item">
                            <h4 class="interpretation-title">· {{ section.title }}</h4>
                            <p class="interpretation-text">{{ section.content }}</p>
                        </div>
                    </div>
                </div>

                <button class="primary-button draw-again-btn" @click="drawAgain">再抽一签</button>

                <!-- 菜单 -->
                <transition name="fade">
                    <div v-if="showMenu" class="menu-overlay" @click="showMenu = false">
                        <div class="menu-popup" @click.stop>
                            <button class="menu-item" @click="shareFortune">分享</button>
                            <button class="menu-item" @click="showMenu = false">取消</button>
                        </div>
                    </div>
                </transition>
            </div>
        </transition>

        <!-- 历史记录页 -->
        <transition name="slide">
            <div v-if="currentPage === 'history'" class="page history-page">
                <div class="page-header">
                    <button class="back-btn" @click="goBack">←</button>
                    <h2 class="page-title">历史记录</h2>
                </div>

                <div class="history-content">
                    <div v-if="history.length === 0" class="empty-state">
                        <p>暂无历史记录</p>
                        <button class="text-button" @click="goToShake">去抽签</button>
                    </div>

                    <div v-else class="history-list">
                        <div
                            v-for="(item, index) in history"
                            :key="index"
                            class="history-card"
                            @click="viewHistoryFortune(item)"
                        >
                            <div class="card-header">
                                <span class="card-number">{{ item.formattedId }}</span>
                                <span class="card-level" :style="{ color: getLevelColor(item.level) }">
                                    {{ item.level }}
                                </span>
                            </div>
                            <p class="card-preview">{{ item.shortDescription }}</p>
                            <p class="card-time">{{ item.formattedTime }}</p>
                        </div>
                    </div>
                </div>

                <button v-if="history.length > 0" class="text-button clear-btn" @click="confirmClearHistory">
                    清空所有记录
                </button>
            </div>
        </transition>

        <!-- 设置页 -->
        <transition name="slide">
            <div v-if="currentPage === 'settings'" class="page settings-page">
                <div class="page-header">
                    <button class="back-btn" @click="goBack">←</button>
                    <h2 class="page-title">设置</h2>
                </div>

                <div class="settings-content">
                    <div class="settings-group">
                        <div class="setting-item">
                            <span>震动反馈</span>
                            <label class="switch">
                                <input type="checkbox" v-model="settings.haptic">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span>音效提示</span>
                            <label class="switch">
                                <input type="checkbox" v-model="settings.sound">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <button class="setting-item clickable" @click="showAbout">
                            <span>关于应用</span>
                            <span class="arrow">›</span>
                        </button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Toast 提示 -->
        <transition name="toast">
            <div v-if="toast.show" class="toast" :class="toast.type">
                {{ toast.message }}
            </div>
        </transition>

        <!-- 全屏图片查看 -->
        <transition name="fade">
            <div v-if="fullscreenImage" class="fullscreen-overlay" @click="closeFullscreen">
                <button class="fullscreen-close">×</button>
                <img :src="fullscreenImage" class="fullscreen-image" @click.stop>
            </div>
        </transition>
    </div>

    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 应用脚本 -->
    <script src="js/app.js"></script>
</body>
</html>
